
<div class="model-screen">

	<div class="col-sm-3 model-list-bar pull-left">
		<div class="model-list-header"> <h1>Models</h1> </div>
		<div class="models-list-group">
			<a data-ng-repeat="model_info in directive_info.models" href="{* model_info.fbx_url *}">
				<button type="button" class="list-group-item list-group-item-action model-panel">
				 <h4>{* model_info.name *}</h4>
				 <small>Last Modified: {* model_info.lastmodified | date:'EEE hh:mm a MMM d, y' *}</small>
				 <p class="description">Description: {* model_info.description | description*}</p>
				</button>
			</a>
		</div>
	</div>


	<div class="model-admin-bar col-sm-2 pull-right">
		<button type="button" class="btn form-control" id="return-button" data-ng-click="directive_info.viewmodel = false; directive_info.patientid = -1"><span class="glyphicon glyphicon-arrow-left"></span> Return to Patients</button>

		<button type="button" class="form-control" id="upload-button" data-ng-click="uploadToggle()"><span class="glyphicon glyphicon-upload"></span> Upload New Model </button>

		<br>

		<form enctype="multipart/form-data" class="add-model-form" id="add-model" data-ng-show="add_model" data-ng-submit="fileUpload()">
			<input type="hidden" name="username" value="{* directive_info.username *}">
			<input type="hidden" name="patientid" value="{* directive_info.patientid *}">

			<div class="form-group">
				<label for="Name">Name</label>
				<input type="text" class="form-control" name="name" placeholder="Name of Model" maxlength="100" data-ng-model="upload_name" required></input>
			</div>

			<div class="form-group">
				<label for="Description">Description</label>
				<textarea class="form-control" rows="4" name="description" placeholder="Description of Model" maxlength="1024" data-ng-model="upload_description" required></textarea>
			</div>

			<div class="form-group">
				<label for="InputFile">File input</label>
				<input type="file" class="form-control-file" id="InputFile" name="file" aria-describedby="fileHelp" file="file" required />
				<small id="fileHelp" class="form-text text-muted">Upload your .obj or .stl file for this patient.</small>
			</div>

			<div class="panel panel-info" data-ng-show="uploading">
				<div class="panel-heading"><div class="loader"> </div> Uploading Model</div>
			</div>

			<div class="panel panel-success" data-ng-show="success.length">
				<div class="panel-heading"><span class="glyphicon glyphicon-ok"></span> {*success*}</div>
			</div>

			<div class="panel panel-danger" data-ng-show="errors.length" data-ng-repeat="error in errors">
				<div class="panel-heading">{* error *}</div>
			</div>

			<input type="submit" class="form-control" id="file_submit" type="submit" value="Upload">
		</form>
		
	</div>


	<!-- For model info and picture cycling? -->
	<p>Where is this?</p>
	<div class="col-sm-6" syle="background-color: red; height: 100px">
		<div>
			<iframe id="viewer" name="viewer" allowfullscreen="" allowvr="" onmousewheel="">
				<!DOCTYPE html>
				<html lang="en">
				<head>
					<title>three.js webgl - loaders - OBJ loader</title>
					<meta charset="utf-8">
					<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
					<style>
						body {
							font-family: Monospace;
							background-color: #000;
							color: #fff;
							margin: 0px;
							overflow: hidden;
						}
						#info {
							color: #fff;
							position: absolute;
							top: 10px;
							width: 100%;
							text-align: center;
							z-index: 100;
							display:block;
						}
						#info a, .button { color: #f00; font-weight: bold; text-decoration: underline; cursor: pointer }
					</style>
				</head>

				<body>
					<div id="info">
						<a href="http://threejs.org" target="_blank">three.js</a> - OBJLoader test
					</div>

					<script src="../threejs/three.js"></script>
					<script src="../threejs/OBJLoader.js"></script>

					<script>
						var container;
						var camera, scene, renderer;
						var mouseX = 0, mouseY = 0;
						var windowHalfX = window.innerWidth / 2;
						var windowHalfY = window.innerHeight / 2;
						init();
						animate();
						function init() {
							container = document.createElement( 'div' );
							document.body.appendChild( container );
							camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 0.1, 2000 );
							camera.position.z = 5;
							camera.zoom = 3
							
							scene = new THREE.Scene();
							var ambient = new THREE.AmbientLight( 0x101030 );
							scene.add( ambient );
							var directionalLight = new THREE.DirectionalLight( 0xffeedd );
							directionalLight.position.set( 0, 0, 1 );
							scene.add( directionalLight );
							
							var manager = new THREE.LoadingManager();
							manager.onProgress = function ( item, loaded, total ) {
								console.log( item, loaded, total );
							};
							var texture = new THREE.Texture();
							var onProgress = function ( xhr ) {
								if ( xhr.lengthComputable ) {
									var percentComplete = xhr.loaded / xhr.total * 100;
									console.log( Math.round(percentComplete, 2) + '% downloaded' );
								}
							};
							var onError = function ( xhr ) {
							};
							var loader = new THREE.ImageLoader( manager );
							loader.load( 'UV_Grid_Sm.jpg', function ( image ) {
								texture.image = image;
								texture.needsUpdate = true;
							} );
							
							var loader = new THREE.OBJLoader( manager );
							loader.load( 'batman70.obj', function ( object ) {
								object.traverse( function ( child ) {
									if ( child instanceof THREE.Mesh ) {
										child.material.map = texture;
									}
								} );
								object.position.y = 0;
								scene.add( object );
							}, onProgress, onError );
							
							renderer = new THREE.WebGLRenderer();
							renderer.setPixelRatio( window.devicePixelRatio );
							renderer.setSize( window.innerWidth, window.innerHeight );
							container.appendChild( renderer.domElement );
							document.addEventListener( 'mousemove', onDocumentMouseMove, false );
							
							window.addEventListener( 'resize', onWindowResize, false );
						}
						function onWindowResize() {
							windowHalfX = window.innerWidth / 2;
							windowHalfY = window.innerHeight / 2;
							camera.aspect = window.innerWidth / window.innerHeight;
							camera.updateProjectionMatrix();
							renderer.setSize( window.innerWidth, window.innerHeight );
						}
						function onDocumentMouseMove( event ) {
							mouseX = ( event.clientX - windowHalfX ) / 2;
							mouseY = ( event.clientY - windowHalfY ) / 2;
						}
						
						function animate() {
							requestAnimationFrame( animate );
							render();
						}
						function render() {
							camera.position.x += ( mouseX - camera.position.x ) * .05;
							camera.position.y += ( - mouseY - camera.position.y ) * .05;
							camera.lookAt( scene.position );
							renderer.render( scene, camera );
						}
					</script>

				</body>
				</html>
			</iframe>
		</div>
	</div>

</div>
